{"version":3,"file":"server.js","sourceRoot":"","sources":["../src/server.ts"],"names":[],"mappings":";;;;;AAAA,sDAAgF;AAChF,gDAAwB;AACxB,6EAAqD;AACrD,gDAAwC;AAGxC,MAAM,GAAG,GAAgB,IAAA,iBAAO,GAAE,CAAC;AACnC,MAAM,IAAI,GAAW,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,MAAM,EAAE,EAAE,CAAC,CAAC;AAG9D,GAAG,CAAC,GAAG,CAAC,IAAA,cAAI,GAAE,CAAC,CAAC;AAChB,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AAGxB,GAAG,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,EAAE,GAAY,EAAE,GAA0B,EAAE,EAAE;IACxE,IAAI,CAAC;QACH,MAAM,QAAQ,GAAG,MAAM,IAAA,kBAAK,EAAwB,6BAA6B,CAAC,CAAC;QAEnF,MAAM,QAAQ,GAAgB;YAC5B,OAAO,EAAE,IAAI;YACb,OAAO,EAAE,8BAA8B;YACvC,IAAI,EAAE;gBACJ,OAAO,EAAE,uBAAuB;gBAChC,OAAO,EAAE,oCAAoC;gBAC7C,MAAM,EAAE,uBAAuB;gBAC/B,QAAQ,EAAE;oBACR,SAAS,EAAE,IAAI;oBACf,WAAW,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW;iBAC1C;gBACD,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,aAAa;gBAClD,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,SAAS,EAAE;oBACT,iBAAiB;oBACjB,oBAAoB;oBACpB,wBAAwB;oBACxB,6CAA6C;oBAC7C,qBAAqB;oBACrB,+BAA+B;iBAChC;aACF;SACF,CAAC;QAEF,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACrB,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,MAAM,QAAQ,GAAgB;YAC5B,OAAO,EAAE,KAAK;YACd,OAAO,EAAE,4CAA4C;YACrD,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS;SAC1E,CAAC;QACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACjC,CAAC;AACH,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,gBAAgB,EAAE,wBAAc,CAAC,CAAC;AAI1C,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAY,EAAE,GAA0B,EAAE,EAAE;IACxD,MAAM,QAAQ,GAAgB;QAC5B,OAAO,EAAE,IAAI;QACb,OAAO,EAAE,2BAA2B;QACpC,IAAI,EAAE;YACJ,OAAO,EAAE,uBAAuB;YAChC,MAAM,EAAE,aAAa;YACrB,aAAa,EAAE,0CAA0C;YACzD,SAAS,EAAE,kCAAkC;SAC9C;KACF,CAAC;IACF,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACrB,CAAC,CAAC,CAAC;AAGH,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAY,EAAE,GAA0B,EAAE,EAAE;IACxD,MAAM,QAAQ,GAAgB;QAC5B,OAAO,EAAE,KAAK;QACd,OAAO,EAAE,oBAAoB;QAC7B,KAAK,EAAE,QAAQ,GAAG,CAAC,WAAW,iBAAiB;KAChD,CAAC;IACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACjC,CAAC,CAAC,CAAC;AAGH,GAAG,CAAC,GAAG,CAAC,CAAC,KAAY,EAAE,GAAY,EAAE,GAA0B,EAAE,IAAkB,EAAE,EAAE;IACrF,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;IAEtC,MAAM,QAAQ,GAAgB;QAC5B,OAAO,EAAE,KAAK;QACd,OAAO,EAAE,uBAAuB;QAChC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,uBAAuB;KACxF,CAAC;IAEF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACjC,CAAC,CAAC,CAAC;AAGH,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM,EAAE,CAAC;IACpC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE;QACpB,OAAO,CAAC,GAAG,CAAC,wCAAwC,IAAI,EAAE,CAAC,CAAC;QAC5D,OAAO,CAAC,GAAG,CAAC,4BAA4B,IAAI,aAAa,CAAC,CAAC;QAC3D,OAAO,CAAC,GAAG,CAAC,gBAAgB,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,aAAa,EAAE,CAAC,CAAC;QACrE,OAAO,CAAC,GAAG,CAAC,gCAAgC,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,MAAM,EAAE,CAAC,CAAC;QAC7E,OAAO,CAAC,GAAG,CAAC,yDAAyD,CAAC,CAAC;IACzE,CAAC,CAAC,CAAC;AACL,CAAC;AAED,kBAAe,GAAG,CAAC","sourcesContent":["import express, { Request, Response, NextFunction, Application } from 'express';\nimport cors from 'cors';\nimport shipmentRoutes from './routes/shipmentRoutes';\nimport { query } from './db/connection';\nimport { ApiResponse } from './types/shipment.types';\n\nconst app: Application = express();\nconst PORT: number = parseInt(process.env.PORT || '5000', 10);\n\n// Middleware\napp.use(cors());\napp.use(express.json());\n\n// Health check endpoint\napp.get('/api/health', async (req: Request, res: Response<ApiResponse>) => {\n  try {\n    const dbResult = await query<{ server_time: Date }>('SELECT NOW() as server_time');\n    \n    const response: ApiResponse = {\n      success: true,\n      message: 'ZYX Logistics API is running',\n      data: {\n        service: 'ZYX Logistics Tracker',\n        version: '2.0.0-alpha (TypeScript Migration)',\n        author: 'Victor Luiz de Fran√ßa',\n        database: {\n          connected: true,\n          server_time: dbResult.rows[0].server_time\n        },\n        environment: process.env.NODE_ENV || 'development',\n        timestamp: new Date().toISOString(),\n        endpoints: [\n          'GET /api/health',\n          'GET /api/shipments',\n          'GET /api/shipments/:id',\n          'GET /api/shipments/tracking/:trackingNumber',\n          'POST /api/shipments',\n          'PUT /api/shipments/:id/status'\n        ]\n      }\n    };\n    \n    res.json(response);\n  } catch (error: any) {\n    const response: ApiResponse = {\n      success: false,\n      message: 'API running but database connection failed',\n      error: process.env.NODE_ENV === 'development' ? error.message : undefined\n    };\n    res.status(500).json(response);\n  }\n});\n\napp.use('/api/shipments', shipmentRoutes);\n// app.use('/api/shipments', shipmentRoutes);\n\n// Temporary root endpoint\napp.get('/', (req: Request, res: Response<ApiResponse>) => {\n  const response: ApiResponse = {\n    success: true,\n    message: 'ZYX Logistics Tracker API',\n    data: {\n      service: 'ZYX Logistics Tracker',\n      status: 'operational',\n      documentation: 'See /api/health for detailed information',\n      migration: 'TypeScript migration in progress'\n    }\n  };\n  res.json(response);\n});\n\n// 404 handler\napp.use('*', (req: Request, res: Response<ApiResponse>) => {\n  const response: ApiResponse = {\n    success: false,\n    message: 'Endpoint not found',\n    error: `Path ${req.originalUrl} does not exist`\n  };\n  res.status(404).json(response);\n});\n\n// Global error handler\napp.use((error: Error, req: Request, res: Response<ApiResponse>, next: NextFunction) => {\n  console.error('Server error:', error);\n  \n  const response: ApiResponse = {\n    success: false,\n    message: 'Internal server error',\n    error: process.env.NODE_ENV === 'development' ? error.message : 'Contact administrator'\n  };\n  \n  res.status(500).json(response);\n});\n\n// Start server\nif (process.env.NODE_ENV !== 'test') {\n  app.listen(PORT, () => {\n    console.log(`ZYX Logistics Server started on port ${PORT}`);\n    console.log(`Health: http://localhost:${PORT}/api/health`);\n    console.log(`Environment: ${process.env.NODE_ENV || 'development'}`);\n    console.log(`Database: PostgreSQL on port ${process.env.DB_PORT || '5433'}`);\n    console.log(`Migration: TypeScript migration in progress (server.ts)`);\n  });\n}\n\nexport default app;\n"]}